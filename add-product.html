{% extends "base.html" %}
{% block content %}

<div class="container my-5">
  <h2 class="mb-4">Add New Product</h2>

  {% if success %}
  <div class="alert alert-success text-center">✅ Product added successfully!</div>
  {% endif %}

  <a href="/admin-dashboard" class="btn btn-outline-secondary mb-3">⬅ Back to Dashboard</a>

  <form id="addProductForm" method="POST" enctype="multipart/form-data" class="p-4 border rounded bg-white shadow-sm">
    <div class="mb-3">
      <label class="form-label">Product Name</label>
      <input type="text" name="name" class="form-control" placeholder="Product Name" required />
    </div>

    <div class="mb-3">
      <label class="form-label">Description</label>
      <input type="text" name="desc" class="form-control" placeholder="Description" required />
    </div>

    <div class="mb-3">
      <label class="form-label">Price</label>
      <input type="number" name="price" class="form-control" placeholder="Price in ₹" required />
    </div>

    <div class="mb-3">
      <label class="form-label">Category</label>
      <select name="category" class="form-select" required>
        {% for cat in categories %}
          <option value="{{ cat.slug }}">{{ cat.name }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- ✅ New: Available Sizes -->
    <div class="mb-3">
      <label class="form-label d-block">Available Sizes</label>
      <div class="d-flex flex-wrap gap-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="sizes" value="S" id="sizeS" checked>
          <label class="form-check-label" for="sizeS">S</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="sizes" value="M" id="sizeM" checked>
          <label class="form-check-label" for="sizeM">M</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="sizes" value="L" id="sizeL" checked>
          <label class="form-check-label" for="sizeL">L</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="sizes" value="XL" id="sizeXL" checked>
          <label class="form-check-label" for="sizeXL">XL</label>
        </div>
      </div>
      <small class="text-muted">Uncheck sizes that are not available for this product.</small>
    </div>
    <!-- ✅ /New -->

    <div class="mb-3">
      <label class="form-label">Upload Images (multiple)</label>
      <input type="file" name="images" class="form-control" accept="image/*" multiple required />
    </div>

    <!-- ✅ New: Size Chart Upload -->
    <div class="mb-3">
      <label class="form-label">Upload Size Chart (optional)</label>
      <input type="file" name="size_chart" class="form-control" accept="image/*" />
      <small class="text-muted">You can upload a size chart image that will appear on the product page.</small>
    </div>
    <!-- ✅ /New -->

    <button type="submit" class="btn btn-success w-100">Add Product</button>
  </form>
</div>

<script>
document.getElementById("addProductForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const form = e.target;
  const formData = new FormData(form);

  try {
    const response = await fetch("/admin/add-product", {
      method: "POST",
      body: formData,
      headers: { "X-Requested-With": "XMLHttpRequest" }
    });

    if (!response.ok) {
      const errText = await response.text();
      console.error("❌ Server returned non-OK:", errText);
      alert("❌ Server error: " + response.status);
      return;
    }

    const result = await response.json();

    if (result.success) {
      form.reset();
      const alert = document.createElement("div");
      alert.className = "alert alert-success text-center mt-3";
      alert.innerText = "✅ Product added successfully!";
      form.parentNode.insertBefore(alert, form);
      setTimeout(() => alert.remove(), 3000);
    } else {
      alert("❌ Something went wrong: " + (result.message || "Unknown error"));
    }
  } catch (err) {
    console.error("❌ JS Error:", err);
    alert("❌ Failed to send request: " + err.message);
  }
});
</script>

{% endblock %}
