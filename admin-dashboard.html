<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #cdcdcd; font-family: "Segoe UI", sans-serif; }
    .btn-success { background-color: #0b4d59; border: none; }
    .btn-success:hover { background-color: #4a8691ff; }
    .btn-outline-danger { border-color: #0b4d59; color: #0b4d59; }
    .btn-outline-danger:hover { background-color: #4a8691ff; color: #fff; }
    .btn-warning { color: white; }
    .table-dark { background-color: #f8c8a0; color: #333; }
    .btn { border: #0b4d59; background-color: #0b4d59; color: #fff; }
    .btn:hover { background-color: #4a8691ff; }
    .table-secondary { background-color: #ffe5b4; }
    .container { background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
    h2, h4 { color: #0b4d59; }
    .list-group-item { background-color: #fffaf0; border: 1px solid #ffe5b4; }
    #adUploadMsg { font-weight: bold; margin-bottom: 20px; }

    @media (max-width: 768px) {
      .table-responsive { display: none; }
      .mobile-product-list { display: block; }
      .product-card { background-color: #fffef5; border: 1px solid #ffd8a8; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
      .product-card img { max-width: 80px; border-radius: 8px; margin-bottom: 10px; }
      .product-card h6 { color: #cc5500; font-weight: 600; }
      .product-card .btn { margin: 4px 0; width: 100%; }
    }

    @media (min-width: 769px) { .mobile-product-list { display: none; } }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h2 class="mb-4 text-center">Admin Dashboard</h2>

    <!-- Button Group -->
    <div class="d-flex flex-wrap justify-content-center gap-2 mb-4">
      <div class="btn-group">
        <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown">üß∞ Manage Products</button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="/admin/add-product">‚ûï Add Product</a></li>
          <li><a class="dropdown-item" href="/admin/remove-products">üóë Remove Products</a></li>
          <li><a class="dropdown-item" href="/admin/out-of-stock">üö´ Out of Stock</a></li>
          <li><a class="dropdown-item" href="/admin/update-price">üí∞ Update Product Price</a></li>
        </ul>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown">üìä View Data</button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="/admin/orders">üì¶ View Recent Orders</a></li>
          <li><a class="dropdown-item" href="/admin/registered-users">üë§ Registered Users</a></li>
        </ul>
      </div>

      <a class="btn btn-success" href="/admin/manage-category">üóÇ Manage Category</a>
      <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#uploadAdModal">üì¢ Upload Ad</button>
      <button id="removeAdBtn" class="btn btn-danger">‚ùå Remove Ad</button>
    </div>

    <div id="adUploadMsg" class="text-success"></div>

    <!-- Upload Ad Modal -->
    <div class="modal fade" id="uploadAdModal" tabindex="-1" aria-labelledby="uploadAdModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form method="POST" action="/admin/upload-ad" enctype="multipart/form-data" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="uploadAdModalLabel">üì¢ Upload New Ad</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <input type="file" name="ad_image" class="form-control" accept="image/*" required />
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Upload</button>
          </div>
        </form>
      </div>
    </div>

    <h4 class="text-center">All Products</h4>

    <div class="d-flex flex-wrap justify-content-center gap-2 mb-3">
      {% for cat in categories %}
        <button class="btn btn-outline-primary" onclick="showCategory('{{ cat }}')">{{ cat.capitalize() }}</button>
      {% endfor %}
    </div>

    <!-- Product Tables -->
    <div id="productTables">
      {% set all_categories = ['all'] + categories %}
      {% for category in all_categories %}
      <div class="product-category-table" id="{{ category|lower }}-table" style="display: none">
        <h5>{{ category.capitalize() }} Products</h5>
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>Image</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for product in products %}
                {% if category == 'all' or product.category.lower() == category.lower() %}
                <tr>
                  <td>{{ product.id }}</td>
                  <td>{{ product.name }}</td>
                  <td>{{ product.category }}</td>
                  <td>‚Çπ{{ product.price }}</td>
                  <td><img src="/static/images/{{ product.image }}" width="80" /></td>
                  <td>{{ product.status }}</td>
                  <td>
                    <form method="POST" action="/admin/update-product-status/{{ product.id }}" style="display:inline-block">
                      <input type="hidden" name="status" value="{% if product.status == 'active' %}outofstock{% else %}active{% endif %}" />
                      <button type="submit" class="btn btn-sm btn-warning">
                        {% if product.status == 'active' %}üö´ Out of Stock{% else %}‚úÖ Activate{% endif %}
                      </button>
                    </form>
                    <form method="POST" action="/admin/remove-product/{{ product.id }}" style="display:inline-block" onsubmit="return confirm('Are you sure you want to remove this product?')">
                      <button type="submit" class="btn btn-sm btn-danger">üóë Remove</button>
                    </form>
                  </td>
                </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Mobile Cards -->
        <div class="mobile-product-list">
          {% for product in products %}
            {% if category == 'all' or product.category.lower() == category.lower() %}
            <div class="product-card">
              <div class="d-flex align-items-center gap-3">
                <img src="/static/images/{{ product.image }}" alt="{{ product.name }}" />
                <div>
                  <h6>{{ product.name }}</h6>
                  <p class="mb-1"><strong>Category:</strong> {{ product.category }}</p>
                  <p class="mb-1"><strong>Price:</strong> ‚Çπ{{ product.price }}</p>
                  <p class="mb-1"><strong>Status:</strong> {{ product.status }}</p>
                </div>
              </div>
              <form method="POST" action="/admin/update-product-status/{{ product.id }}" class="mt-2">
                <input type="hidden" name="status" value="{% if product.status == 'active' %}outofstock{% else %}active{% endif %}" />
                <button type="submit" class="btn btn-sm btn-warning">
                  {% if product.status == 'active' %}üö´ Out of Stock{% else %}‚úÖ Activate{% endif %}
                </button>
              </form>
              <form method="POST" action="/admin/remove-product/{{ product.id }}" class="mt-2" onsubmit="return confirm('Are you sure you want to remove this product?')">
                <button type="submit" class="btn btn-sm btn-danger">üóë Remove</button>
              </form>
            </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function showCategory(category) {
      document.querySelectorAll('.product-category-table').forEach(table => {
        if (table.id === category.toLowerCase() + "-table") {
          const isVisible = table.style.display === "block";
          table.style.display = isVisible ? "none" : "block";
        } else {
          table.style.display = "none";
        }
      });
    }

    document.getElementById("removeAdBtn").addEventListener("click", function () {
      if (confirm("Are you sure you want to remove the current ad?")) {
        fetch("/admin/remove-ad", {
          method: "POST",
          headers: { "X-Requested-With": "XMLHttpRequest" }
        })
        .then(res => res.json())
        .then(data => {
          document.getElementById("adUploadMsg").innerText = data.success
            ? "‚úÖ Ad removed successfully."
            : "‚ùå Failed to remove ad.";
        })
        .catch(err => {
          document.getElementById("adUploadMsg").innerText = "‚ö†Ô∏è Error removing ad.";
          console.error(err);
        });
      }
    });
  </script>
</body>
</html>
